<!DOCTYPE html>
<html>
<head>
    <title>OAuth Callback - Barcode Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }
        .success {
            color: green;
            border: 2px solid green;
            padding: 20px;
            border-radius: 10px;
            background: #f0fff0;
        }
        .error {
            color: red;
            border: 2px solid red;
            padding: 20px;
            border-radius: 10px;
            background: #fff0f0;
        }
        code {
            background: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
            display: inline-block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîó OAuth Callback Handler</h1>
    <p>For Barcode Scanner Mobile App</p>
    
    <div id="message">
        <p>Waiting for authentication redirect...</p>
        <p><small>This page handles OAuth callbacks from Sdfa API</small></p>
    </div>
    
    <script>
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const token = urlParams.get('token');
        const access_token = urlParams.get('access_token');
        const error = urlParams.get('error');
        const error_description = urlParams.get('error_description');
        
        const messageDiv = document.getElementById('message');
        
        // Handle successful authorization
        if (code) {
            messageDiv.innerHTML = `
                <div class="success">
                    <h2>‚úÖ Authentication Successful!</h2>
                    <p>Authorization code received:</p>
                    <code>${code}</code>
                    <p>You can now close this window and return to the Barcode Scanner app.</p>
                    <p><small>This code will be exchanged for an access token.</small></p>
                </div>
            `;
            console.log('OAuth Authorization Code:', code);
            
        // Handle direct token (if Sdfa uses implicit flow)
        } else if (token || access_token) {
            const actualToken = token || access_token;
            messageDiv.innerHTML = `
                <div class="success">
                    <h2>‚úÖ Access Token Received!</h2>
                    <p>Token (first 30 chars):</p>
                    <code>${actualToken.substring(0, 30)}...</code>
                    <p>You can now close this window and return to the app.</p>
                </div>
            `;
            
        // Handle errors
        } else if (error) {
            messageDiv.innerHTML = `
                <div class="error">
                    <h2>‚ùå Authentication Failed</h2>
                    <p>Error: <strong>${error}</strong></p>
                    ${error_description ? `<p>Details: ${error_description}</p>` : ''}
                    <p>Please try again or contact support.</p>
                </div>
            `;
            
        // No parameters yet (landing page)
        } else {
            messageDiv.innerHTML += `
                <hr>
                <h3>üìã Test this page:</h3>
                <p>Add these to the URL to simulate OAuth response:</p>
                <ul style="text-align: left; display: inline-block;">
                    <li><code>?code=AUTHORIZATION_CODE_HERE</code></li>
                    <li><code>?error=access_denied</code></li>
                    <li><code>?access_token=TOKEN_HERE</code></li>
                </ul>
            `;
        }
        
        // Log all parameters for debugging
        console.log('URL Parameters:', Object.fromEntries(urlParams));
    </script>
    
    <footer style="margin-top: 40px; color: #666; font-size: 12px;">
        <p>Barcode Scanner App ‚Ä¢ OAuth Callback Handler</p>
        <p>URL: ${window.location.href}</p>
    </footer>
</body>
</html>
